@model IEnumerable<CartIndex>

@{
    ViewBag.Title = "Index";
}

<div class="container-xl">
    <div class="order-nav">
        <div class="title">
            <h2>
                購物步驟
            </h2>
        </div>
        <div class="step row">
            <li class="col-6 col-sm-2 active"><a href="#">1.確認購物明細</a></li>
            <li class="col-6 col-sm-2"><a href="#">2.確認訂單明細</a></li>
            <li class="col-6 col-sm-2"><a href="#">3.進行付款</a></li>
            <li class="col-6 col-sm-2"><a href="#">4.完成訂購</a></li>
        </div>
    </div>

    @*
        <p>
            @Html.ActionLink("Create New", "Create")
        </p>
    *@

<div class="order-content">
    <div class="content-nav">
        <li class="active"><a href="#">購物明細(@Model.Count())</a></li>
        @*<li><a href="#">追蹤清單({X})</a></li>*@
    </div>
    <div class="content">
        <table class="table">
            <tr>
                <th>
                    <span>商品名稱</span>
                </th>
            </tr>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        <div class="product">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                                <label class="form-check-label" for="flexCheckDefault">

                                </label>
                            </div>
                            <div class="product-img">
                                <a href="#">
                                    <img src="~/Assets/images/cart/A451.jpg" />
                                </a>
                            </div>
                            <div class="product-name">
                                <a href="#">
                                    @*{JavaScript 學習手冊}*@
                                    @Html.DisplayFor(m => item.ProductName)
                                </a>
                            </div>
                        </div>
                        <div class="product-stock">
                            <p>
                                @{
                                    if (item.Available)
                                    {
                                    <p>立即出貨</p>}
                                else
                                {<p>暫時無法租借</p>}
                                }
                                </p>
                                <!-- Button trigger modal setDate -->
                                <button class="orange d-flex justify-content-evenly align-items-center" data-bs-toggle="modal" data-bs-target="#DateModal">
                                    設定租借期間
                                    <!-- POST資料用 -->
                                    @*@Html.HiddenFor(M => M.StartDate)
                                    @Html.HiddenFor(M => M.ExpirationDate)*@
                                </button>
                            </div>
                            <div class="product-price-qty">
                                <div class="unitprice">
                                    <span class="title">日租價格 :</span>
                                    <span class="price">
                                        @Html.DisplayFor(m => item.DailyRate)
                                    </span>
                                </div>
                                <div class="buyqty">
                                    <span class="title">租借數量 :</span>
                                    <input type="number" value="1" class="qty" readonly>
                                </div>
                            </div>
                            <div class="product-sub">
                                <span class="title">小計 :</span>
                                <span class="subTotal">
                                    @Html.DisplayFor(m => item.Sub)
                                </span>
                            </div>
                        </td>

                        @*<td>
                                    @Html.ActionLink("Edit", "Edit", new { /* id=item.PrimaryKey */ }) |
                                    @Html.ActionLink("Details", "Details", new { /* id=item.PrimaryKey */ }) |
                                    @Html.ActionLink("Delete", "Delete", new { Memberid = item.MemberID, Productid = item.ProductID })
                            </td>*@

                    </tr>
                }

            <tr>
                <td>
                    <div class="order-total">
                        <span>總計：</span>
                        <span class="currency">TWD$</span> &emsp;
                        <span class="total">
                            @ViewBag.Total
                        </span>
                    </div>
                </td>
            </tr>
        </table>
        <div class="content-footer">
            <div>
                <p>超商取貨滿350元免運費，未滿350元酌收處理費40元，宅配郵寄未滿1000元需加收50元運費</p>
            </div>
            <div class="checkout">
                <button type="button" class="btn">進行結帳</button>
            </div>
        </div>
        <div class="notice">
            <h2>注意事項</h2>
            <div class="content-inner-block">
                <h3>訂購缺書書籍的訂單</h3>
                <p>當您的訂單中同時包含缺書中與有現貨之書籍時，將於書籍到齊後才一併出貨及寄出，若您不願等待缺書中之書籍，建議將有現貨與缺貨籍各別下訂單。</p>
                <h3>缺貨書籍需等候時間</h3>
                <p>缺貨之書籍，根據供貨來源不同，約可分為下列四種：</p>
                <li>中文書：供應商有現貨，約 3~7個工作天左右可到貨</li>
                <li>非天瓏代理進口之原文書：若代理商有現貨，約 5~8個工作天左右到貨</li>
                <li>天瓏代理進口之原文書：若國外供應商有現貨，約 2週~4週左右到貨</li>
                <li>代購書籍：若國外廠商可供貨，約 2週~4週左右到貨</li>
                <p>以上到貨時間若因無法控制之因素而延遲到貨，我們將儘速通知您，您可自行決定是否保留訂單繼續等候或是取消訂單。</p>
                <p>若書籍有無法供貨情形發生，我們會打電話通知您。</p>
                <h3>選擇匯款或劃撥之訂單</h3>
                <p>下單後請別先行匯款，請在收到我們的匯款通知信後，再去匯款即可，並通知我們您的匯款資訊，以加速訂單處理速度。</p>
            </div>
        </div>
    </div>

    @Html.Partial("../Shared/_DateTimeModal")
    <input type="hidden" name="StartDate" value="" />
    <input type="hidden" name="ExpirationDate" value="" />
</div>
</div>

@section topCSS{
    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <!-- dateTimePicker 套件-->
    <link rel="stylesheet" href="~/Assets/css/ProductDetail/flatpickr_orange.css" />

    <link rel="stylesheet" href="~/Assets/css/Cart/navbar.css" />
    <link rel="stylesheet" href="~/Assets/css/Cart/ordercontent.css" />
    <!-- dateTimePicker 自訂-->
    <link rel="stylesheet" href="~/Assets/css/ProductDetail/dateTimePicker.css" />
}

@section endJS{
    <!-- dateTimePicker套件 -->
    <script src="~/Assets/js/ProductDetail/flatpickr.js"></script>
    <!-- 指定DateModalLauncher -->
    <script>
        let DateModalLauncher = null;
        let StartDateToPost = null;
        let ExpirationDateToPost = null;

        let DateModalBtns = document.querySelectorAll('button[data-bs-target="#DateModal"]');

        //如果是List就可以用index取
        DateModalBtns.forEach((btn, idx) =>
            btn.addEventListener('click', function (ev) {
                DateModalLauncher = ev.target;
                //設定要POST資料的是哪個欄位
                //StartDateToPost = ...idx;
                //ExpirationDateToPost = ...idx;
                StartDateToPost = document.querySelector('input[name="StartDate"]');
                ExpirationDateToPost = document.querySelector('input[name="ExpirationDate"]');

                //禁用日期
                @*datePicker.config.disable = @Html.Raw(Model.DisablePeriodsJSON) ;*@
                //如果存在於購物車且 日期已選=>填入日期選取器的選取?。  顯示文字//Model.IsExisted &&
                @*if ( @Json.Encode(Model.StartDate!=null ) ) {
                    showPeriodText(DateModalLauncher,'@(Model.StartDate)', '@Model.ExpirationDate');
                }*@
            })
        );
    </script>
    <!-- dateTimePicker自訂 -->
    <script src="~/Assets/js/ProductDetail/dateTimePicker.js"></script>
}