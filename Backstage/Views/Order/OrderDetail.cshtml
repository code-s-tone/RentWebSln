@{
    ViewData["Title"] = "ProductDetail";
}
<h1>訂單資料</h1>
<b-container fluid id="app" class="m-2 w-50 m-auto">
    @*<form>*@

    <b-col>
        <label for="input-small">訂單人姓名:</label>
    </b-col>
    <b-col>
        <b-form-input id="input-small" placeholder="請輸入" v-model="items.fullName" v-bind:class="{ 'is-invalid': usernameError }"></b-form-input>
        <div class=" text-danger">
            {{ userErrMsg }}
        </div>
    </b-col>

    <b-col>
        <label for="input-small" class="mt-3">分店地址: </label>
    </b-col>
    <b-col>
        <b-form-input id="input-small" placeholder="例如 : 1中華大學新竹總店、2新竹站前分店、3新竹高鐵站分店" v-model="items.storeID" v-bind:class="{ 'is-invalid': storeError }" ></b-form-input>
        <div class=" text-danger">
            {{ storeErrMsg }}
        </div>
    </b-col>

    <b-col>
        <label for="input-small" class="mt-3">聯絡電話:</label>
    </b-col>
    <b-col>
        <b-form-input id="input-small" placeholder="請輸入" v-model="items.phone" v-bind:class="{ 'is-invalid': phoneError }"></b-form-input>
        <div class=" text-danger">
            {{ phoneErrMsg }}
        </div>
    </b-col>

    <b-col>
        <label for="input-small" class="mt-3">出貨狀態: </label>
    </b-col>
    <b-col>
        <b-form-input id="input-small" placeholder="例如 : 已歸還、待出貨、已出貨、已到貨、已取貨" v-model="items.goodsStatusID" v-bind:class="{ 'is-invalid': goodsError }"></b-form-input>
        <div class=" text-danger">
            {{ goodsErrMsg }}
        </div>
    </b-col>


    <b-col class="text-center mt-5">
        <b-button @@click="EditData()" variant="primary">送出修改</b-button>
        <b-button @@click="history.go(-1)">取消</b-button>
    </b-col>
    @*</form>*@

</b-container>


@section topJS{
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.4/axios.min.js" integrity="sha512-lTLt+W7MrmDfKam+r3D2LURu0F47a3QaW5nF0c6Hl0JDZ57ruei+ovbg7BrZ+0bjVJ5YgzsAWE+RreERbpPE1g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"></script>
}

@section endJS{
    <script>
        let Json =
        {
            "orderID": "",
            "fullName": "",
            "storeName": "",
            "phone": "",
            "goodsStatusID": "",
            "storeID":"",

        }
        let vm;
        let url = location.href;
        vm = new Vue({
            el: "#app",
            data: {
                items: Json,
                usernameError: false,
                userErrMsg: '',
                storeError: false,
                storeErrMsg: '',
                phoneError: false,
                phoneErrMsg: '',
                goodsError: false,
                goodsErrMsg: '',

            },
            methods: {
                EditData() {
                    let PUrl = "/api/OrderApi/UpdateOrder";
                    fetch(PUrl,
                        {
                            method: "Post",
                            body: JSON.stringify(this.$data.items),
                            headers: {

                                'Content-Type': 'application/json'
                            },
                        })
                        .then(res => {

                            this.$data.items = res[0];
                            console.log(res);
                            console.log(res.ok);
                            console.log(res.status);

                            swal("修改成功", {
                                icon: 'success',
                                button: false,
                            })
                            window.setTimeout("window.location ='/Order/Index/'", 2000);//兩秒後跳轉
                        })
                        .catch(ex => {
                            console.log("錯了");
                        })
                },
            },
            watch: {
                'items.fullName': function () {
                    var isText = /^[a-zA-Z0-9]+$/;
                    if (this.items.fullName == '') {
                        this.usernameError = true;
                        this.userErrMsg = '姓名不得為空';
                    }
                    //else if (!isText.test(this.items.fullName)) {
                    //    this.usernameError = true;
                    //    this.userErrMsg = '請勿包含特殊字元';

                    //}
                    else {
                        this.usernameError = false;
                        this.userErrMsg = '';

                    }
                },
                'items.storeID': function () {
                    var isText = /^[123]{1}$/;
                    if (this.items.storeID == '') {
                        this.storeError = true;
                        this.storeErrMsg = '分店不得為空';
                    }
                    else if (!isText.test(this.items.storeID)) {
                        this.storeError = true;
                        this.storeErrMsg = '請輸入正確的分店格式 EX : 1、2、3';
                    }
                    else {
                        this.storeError = false;
                        this.storeErrMsg = '';
                    }
                },
                'items.phone': function () {
                    var isText = /^[0-9]+$/;
                    if (this.items.phone == '') {
                        this.phoneError = true;
                        this.phoneErrMsg = '電話不得為空';
                    }
                    else if (!isText.test(this.items.phone)) {
                        this.phoneError = true;
                        this.phoneErrMsg = '請勿包含數字以外的特殊字元';

                    }
                    else if (this.items.phone.length != 10) {
                        this.phoneError = true;
                        this.phoneErrMsg = '請輸入正確的手機格式';
                    }
                    else {
                        this.phoneError = false;
                        this.phoneErrMsg = '';

                    }
                },
                'items.goodsStatusID': function () {
                    var isText = /[\u4e00-\u9fa5]{3}$/;
                    if (this.items.goodsStatusID == '') {
                        this.goodsError = true;
                        this.goodsErrMsg = '貨物狀態不得為空';
                    }
                    else if (!isText.test(this.items.goodsStatusID)) {
                        this.goodsError = true;
                        this.goodsErrMsg = '請輸入正確的貨物狀態格式';
                    }
                    else {
                        this.goodsError = false;
                        this.goodsErrMsg = '';

                    }
                },

            }
        });

        function LoadData() {
            let orderID = url.split("/")[5]
            let GUrl = `/api/OrderApi/GetOrderDetail/${orderID}`;
            fetch(GUrl,
                {
                    method: "Get",
                    headers: {
                        'Content-Type': 'application/json'
                    },

                }).then(res => res.json())
                .then(result => {
                    vm.$data.items = result[0];
                    console.log(result);
                    console.log("有進來了");
                })
                .catch(ex => {
                    console.log("錯了");
                })
        };

        $(document).ready(function () {
            LoadData();
        });
    </script>
}